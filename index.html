<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J's Studio | Nova v5</title>
    <style>
        :root {
            --bg-color: #f4f4f4;
            --sidebar-width: 340px;
            --accent-black: #111;
            --border: #ddd;
            --danger: #d63031;
            --select: #ff7675;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-color);
            color: #333;
        }

        /* 侧边栏 */
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.03);
            z-index: 20;
            transition: transform 0.3s ease;
        }
        .sidebar.collapsed { transform: translateX(-100%); position: absolute; height: 100%; }

        /* 选项卡 */
        .tabs { display: flex; border-bottom: 1px solid var(--border); background: #fafafa; }
        .tab-btn {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            font-size: 13px; font-weight: 600; color: #888; transition: 0.2s;
        }
        .tab-btn.active { background: #fff; color: #000; border-bottom: 2px solid #000; }

        .panel { display: none; flex: 1; flex-direction: column; padding: 20px; overflow-y: auto; }
        .panel.active { display: flex; }

        /* 控件 */
        .group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .group:last-child { border: none; }
        label { display: block; font-size: 11px; font-weight: 700; color: #999; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }

        button {
            width: 100%; padding: 10px; border: none; background: var(--accent-black);
            color: #fff; font-size: 13px; cursor: pointer; border-radius: 3px;
            transition: opacity 0.2s; margin-top: 5px;
        }
        button:hover { opacity: 0.85; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button.sec { background: #fff; color: #000; border: 1px solid #ccc; }
        button.danger { background: var(--danger); color: white; }
        button.toggle { background: #eee; color: #333; }
        button.toggle.active { background: var(--select); color: white; }

        input, select {
            width: 100%; padding: 8px; font-size: 13px;
            border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box;
            background: #fff; margin-bottom: 5px;
        }
        input:focus { border-color: #000; outline: none; }

        /* 画布 */
        .canvas-area {
            flex: 1; background: #e0e0e0; display: flex;
            justify-content: center; align-items: flex-start;
            overflow-y: auto; padding: 40px; position: relative;
        }

        #grid {
            background: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: grid; width: 100%; max-width: 1200px;
            padding: 0; gap: 0;
        }

        /* 卡片 */
        .card {
            position: relative; background: #ccc; overflow: hidden;
            aspect-ratio: 1; transition: transform 0.2s, opacity 0.2s;
            cursor: grab;
        }
        .card:active { cursor: grabbing; }
        .card.dragging { opacity: 0.4; border: 2px dashed #000; }
        .card img { width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }

        /* 删除按钮 */
        .del-btn {
            position: absolute; top: 0; right: 0;
            width: 20px; height: 20px; background: rgba(214, 48, 49, 0.9);
            color: white; text-align: center; line-height: 20px;
            font-size: 14px; cursor: pointer; z-index: 10;
            display: none;
        }
        .card:hover .del-btn { display: block; }

        /* 状态 */
        .card.selected { outline: 4px solid var(--select); outline-offset: -4px; }
        .card.dimmed { opacity: 0.1; filter: grayscale(100%); }

        /* 背面 */
        .card-back {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; padding: 10px; box-sizing: border-box;
            transform: translateY(100%); transition: transform 0.3s;
            z-index: 4;
        }
        .card.flipped .card-back { transform: translateY(0); }
        textarea {
            width: 100%; height: 100%; background: transparent; border: none;
            color: #ddd; resize: none; outline: none; font-size: 12px; font-family: inherit;
        }

        /* 序号与翻转钮 */
        .badge {
            position: absolute; top:0; left:0;
            background: rgba(255,255,255,0.95); color: #000;
            font-size: 28px; font-weight: 800; padding: 0 12px;
            border-bottom-right-radius: 12px; z-index: 3; pointer-events: none;
        }
        .flip-icon {
            position: absolute; bottom: 8px; right: 8px;
            width: 24px; height: 24px; background: rgba(0,0,0,0.6);
            color: #fff; border-radius: 50%; text-align: center;
            line-height: 24px; cursor: pointer; z-index: 5; font-size: 10px;
            transition: 0.2s;
        }
        .flip-icon:hover { background: #000; }

        /* 存档列表 */
        .archive-item {
            background: #fff; padding: 12px; border-radius: 3px;
            margin-bottom: 8px; border: 1px solid #eee; display: flex;
            justify-content: space-between; align-items: center;
        }
        .archive-item:hover { border-color: #999; }
        .archive-info { flex:1; cursor: pointer; }
        .archive-info h4 { margin:0 0 5px 0; font-size:13px; font-weight:600; }
        .archive-info p { margin:0; font-size:11px; color:#888; font-family: monospace; }

        /* 灯箱 (Lightbox) 预览 */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        #lb-content {
            position: relative; max-width: 90%; max-height: 80%;
            perspective: 1000px;
        }
        #lb-img-container {
            position: relative; transition: transform 0.6s; transform-style: preserve-3d;
        }
        #lb-img-container.flipped { transform: rotateY(180deg); }

        #lb-front, #lb-back {
            backface-visibility: hidden;
        }
        #lb-front img { max-width: 100%; max-height: 80vh; border: 2px solid #333; display: block; }

        #lb-back {
            position: absolute; top:0; left:0; width: 100%; height: 100%;
            background: #222; transform: rotateY(180deg);
            padding: 20px; box-sizing: border-box; border: 1px solid #444;
            display: flex; align-items: center; justify-content: center;
        }
        #lb-back textarea {
            font-size: 16px; color: #fff; text-align: center;
        }

        #lb-controls {
            margin-top: 20px; display: flex; gap: 20px;
        }
        #lb-controls button { width: auto; padding: 8px 20px; background: #333; border: 1px solid #555; }
        #lb-controls button:hover { background: #fff; color: #000; }

        #hint {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: #fff; padding: 5px 15px; border-radius: 20px;
            font-size: 12px; opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="hint">Tip: 双击空白处专注显示 | 拖拽图片可排序</div>

<!-- 灯箱预览 -->
<div id="lightbox" onclick="if(event.target===this) closeLightbox()">
    <div id="lb-content">
        <div id="lb-img-container">
            <div id="lb-front"><img id="lb-img" src=""></div>
            <div id="lb-back"><textarea id="lb-note" readonly></textarea></div>
        </div>
    </div>
    <div id="lb-controls">
        <button onclick="document.getElementById('lb-img-container').classList.toggle('flipped')">翻转 / 查看备注</button>
        <button onclick="closeLightbox()">关闭预览</button>
    </div>
</div>

<div class="sidebar" id="sidebar">
    <div class="tabs">
        <div class="tab-btn active" onclick="setTab('editor')">拼图制作</div>
        <div class="tab-btn" onclick="setTab('vault')">本地存档</div>
    </div>

    <!-- 制作区 -->
    <div id="panel-editor" class="panel active">
        <div class="group" style="padding-bottom:10px;">
            <input type="text" id="editorSearch" placeholder="搜索内容(变暗非匹配项)..." oninput="filterEditor()" style="border-left:3px solid #333;">
        </div>

        <div class="group">
            <label>1. 图片管理 (<span id="count">0</span>)</label>
            <input type="file" id="fileIn" multiple accept="image/*" style="display:none" onchange="addFiles(this.files)">
            <button onclick="document.getElementById('fileIn').click()">+ 添加图片</button>
            <div style="display:flex; gap:5px;">
                <button class="toggle" id="btnSelect" onclick="toggleSelectMode()" style="flex:1">批量选择模式</button>
                <button class="danger" id="btnDelSel" onclick="deleteSelected()" style="flex:1; display:none;">删除选中</button>
            </div>
            <button class="sec" onclick="shuffle()" style="margin-top:5px;">随机打乱 (Shuffle)</button>
        </div>

        <div class="group">
            <label>2. 布局设置</label>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <!-- 默认数值改为 6 -->
                <input type="number" id="cols" value="6" min="1" onchange="render()" placeholder="列数" style="flex:1">
                <input type="number" id="gap" value="0" min="0" onchange="render()" placeholder="间距" style="flex:1">
            </div>
            <!-- 默认比例改为 9/16，去除文字描述 -->
            <select id="ratio" onchange="render()">
                <option value="9/16" selected>9 : 16</option>
                <option value="16/9">16 : 9</option>
                <option value="1/1">1 : 1</option>
                <option value="3/4">3 : 4</option>
                <option value="4/3">4 : 3</option>
                <option value="2/3">2 : 3</option>
                <option value="3/2">3 : 2</option>
                <option value="7/5">7 : 5</option>
                <option value="5/7">5 : 7</option>
            </select>
        </div>

        <div class="group">
            <label>3. 标记与水印</label>
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <span style="font-size:13px">显示大序号</span>
                <input type="checkbox" id="chkNum" checked onchange="render()" style="width:auto">
            </div>

            <label>防盗白线织网 (透明度)</label>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="range" id="wmAlpha" min="0" max="100" value="0" style="flex:1" oninput="document.getElementById('wmVal').innerText = this.value + '%'">
                <span id="wmVal" style="font-size:12px; width:35px; text-align:right;">0%</span>
            </div>
        </div>

        <div class="group">
            <label>4. 导出 (bengdai)</label>
            <button onclick="exportStitch()">保存拼图 (高清)</button>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <input type="text" id="dlIdx" placeholder="序号如 1 3" style="flex:2">
                <button class="sec" onclick="dlSingle()" style="flex:1; margin-top:0">下原图</button>
            </div>
        </div>

        <div class="group" style="border:none">
            <label>5. 存档</label>
            <input type="text" id="arcName" placeholder="存档命名...">
            <button class="sec" onclick="saveToVault()">存入本地数据库</button>
        </div>
    </div>

    <!-- 存档区 -->
    <div id="panel-vault" class="panel">
        <input type="text" id="vaultSearch" placeholder="搜索存档库..." oninput="loadVaultList()">
        <div id="vaultList" style="flex:1; margin-top:10px;"></div>
        <button class="danger" onclick="nukeDB()">⚠ 清空库</button>
    </div>
</div>

<div class="canvas-area" ondblclick="toggleFocus()">
    <div id="grid"></div>
</div>

<script>
    // --- 核心数据 ---
    let images = [];
    let db;
    let selectMode = false;
    let selectedSet = new Set();
    let dragSrcIndex = null; // 拖拽源

    // --- 数据库初始化 ---
    const req = indexedDB.open("NovaPuzzle_v5", 1);
    req.onupgradeneeded = e => {
        const d = e.target.result;
        if(!d.objectStoreNames.contains("archives")) {
            d.createObjectStore("archives", {keyPath: "id", autoIncrement:true});
        }
    };
    req.onsuccess = e => { db = e.target.result; loadVaultList(); };

    // --- 拖拽逻辑 ---
    function handleDragStart(e, index) {
        dragSrcIndex = index;
        e.target.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragOver(e) {
        if(e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
    }

    function handleDrop(e, targetIndex) {
        if(e.stopPropagation) e.stopPropagation();
        if(dragSrcIndex !== null && dragSrcIndex !== targetIndex) {
            // 交换逻辑
            const srcItem = images[dragSrcIndex];
            images.splice(dragSrcIndex, 1);
            images.splice(targetIndex, 0, srcItem);
            render();
        }
        return false;
    }

    // --- 预览灯箱逻辑 ---
    function openLightbox(index) {
        const imgObj = images[index];
        const lb = document.getElementById('lightbox');
        const imgEl = document.getElementById('lb-img');
        const noteEl = document.getElementById('lb-note');
        const container = document.getElementById('lb-img-container');

        imgEl.src = URL.createObjectURL(imgObj.blob);
        noteEl.value = imgObj.note || "(无备注)";
        container.classList.remove('flipped'); // 重置翻转状态

        lb.style.display = 'flex';
    }

    function closeLightbox() {
        document.getElementById('lightbox').style.display = 'none';
    }

    // --- 制作区逻辑 ---
    function setTab(t) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        if(t==='editor') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('panel-editor').classList.add('active');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('panel-vault').classList.add('active');
            loadVaultList();
        }
    }

    function toggleFocus() {
        document.getElementById('sidebar').classList.toggle('collapsed');
        const h = document.getElementById('hint');
        h.style.opacity = 1;
        setTimeout(()=>h.style.opacity=0, 2000);
    }

    function addFiles(files) {
        if(!files.length) return;
        Array.from(files).forEach(f => {
            const isDup = images.some(img => img.name === f.name);
            if(isDup && !confirm(`图片 "${f.name}" 已存在，要重复添加吗？`)) return;
            images.push({
                blob: f, name: f.name, note: "",
                id: Date.now() + Math.random().toString()
            });
        });
        document.getElementById('fileIn').value = '';
        render();
    }

    function removeImg(e, id) {
        e.stopPropagation();
        if(confirm("确定移除此图片？")) {
            images = images.filter(img => img.id !== id);
            selectedSet.delete(id);
            render();
        }
    }

    function toggleSelectMode() {
        selectMode = !selectMode;
        selectedSet.clear();
        document.getElementById('btnSelect').classList.toggle('active');
        document.getElementById('btnDelSel').style.display = selectMode ? 'block' : 'none';
        render();
    }

    function deleteSelected() {
        if(!selectedSet.size) return;
        if(confirm(`删除选中的 ${selectedSet.size} 张？`)) {
            images = images.filter(img => !selectedSet.has(img.id));
            selectedSet.clear();
            toggleSelectMode();
            render();
        }
    }

    function filterEditor() {
        const key = document.getElementById('editorSearch').value.toLowerCase();
        document.querySelectorAll('.card').forEach(c => {
            const note = c.querySelector('textarea').value.toLowerCase();
            if(key && !note.includes(key)) c.classList.add('dimmed');
            else c.classList.remove('dimmed');
        });
    }

    function shuffle() {
        if(confirm("打乱顺序？")) {
            for (let i = images.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [images[i], images[j]] = [images[j], images[i]];
            }
            render();
        }
    }

    function render() {
        const grid = document.getElementById('grid');
        const cols = document.getElementById('cols').value;
        const gap = document.getElementById('gap').value;
        const rStr = document.getElementById('ratio').value.split('/');
        const ratioCSS = `${rStr[0]}/${rStr[1]}`;
        const showNum = document.getElementById('chkNum').checked;

        grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        grid.style.gap = `${gap}px`;
        grid.innerHTML = '';
        document.getElementById('count').innerText = images.length;

        images.forEach((img, idx) => {
            const div = document.createElement('div');
            div.className = `card ${selectedSet.has(img.id) ? 'selected' : ''}`;
            div.style.aspectRatio = ratioCSS;

            // 拖拽属性
            div.draggable = true;
            div.ondragstart = (e) => handleDragStart(e, idx);
            div.ondragover = handleDragOver;
            div.ondrop = (e) => handleDrop(e, idx);
            div.ondragend = handleDragEnd;

            // 点击逻辑
            div.onclick = (e) => {
                if(e.target.tagName === 'TEXTAREA' || e.target.classList.contains('flip-icon') || e.target.classList.contains('del-btn')) return;

                if(selectMode) {
                    if(selectedSet.has(img.id)) selectedSet.delete(img.id);
                    else selectedSet.add(img.id);
                    render();
                } else {
                    openLightbox(idx); // 非选择模式下，点击预览
                }
            };

            const src = URL.createObjectURL(img.blob);
            div.innerHTML = `
                <img src="${src}">
                <div class="del-btn" onclick="removeImg(event, '${img.id}')">×</div>
                ${showNum ? `<div class="badge">${idx+1}</div>` : ''}
                <div class="card-back">
                    <textarea placeholder="备注...">${img.note}</textarea>
                </div>
                <div class="flip-icon" onclick="event.stopPropagation(); this.parentElement.classList.toggle('flipped')">↻</div>
            `;

            div.querySelector('textarea').oninput = (e) => img.note = e.target.value;
            grid.appendChild(div);
        });
        filterEditor();
    }

    // --- 导出逻辑 (保持不变) ---
    async function exportStitch() {
        if(!images.length) return;
        const btn = document.querySelector('button[onclick="exportStitch()"]');
        btn.innerText = "生成中..."; btn.disabled = true;

        try {
            const cols = parseInt(document.getElementById('cols').value);
            const gap = parseInt(document.getElementById('gap').value);
            const rStr = document.getElementById('ratio').value.split('/');
            const ratio = rStr[0]/rStr[1];
            const showNum = document.getElementById('chkNum').checked;
            const wmOp = parseInt(document.getElementById('wmAlpha').value) / 100;

            let cellW = 1500;
            const rows = Math.ceil(images.length / cols);
            let totalW = cols*cellW + (cols-1)*gap;
            let totalH = rows*(cellW/ratio) + (rows-1)*gap;

            // 限制防崩
            const MAX = 60000000;
            if(totalW*totalH > MAX) {
                const s = Math.sqrt(MAX/(totalW*totalH));
                cellW = Math.floor(cellW * s);
                totalW = cols*cellW + (cols-1)*gap;
                totalH = rows*(cellW/ratio) + (rows-1)*gap;
            }
            const cellH = cellW/ratio;

            const cvs = document.createElement('canvas');
            cvs.width = totalW; cvs.height = totalH;
            const ctx = cvs.getContext('2d');
            ctx.fillStyle = "#fff"; ctx.fillRect(0,0, totalW, totalH);

            for(let i=0; i<images.length; i++) {
                const info = images[i];
                const img = new Image();
                img.src = URL.createObjectURL(info.blob);
                await new Promise(r => img.onload = r);

                const c = i % cols; const r = Math.floor(i/cols);
                const x = c*(cellW+gap); const y = r*(cellH+gap);

                let sx, sy, sw, sh;
                const ir = img.naturalWidth / img.naturalHeight;
                if(ir > ratio) {
                    sh=img.naturalHeight; sw=sh*ratio; sx=(img.naturalWidth-sw)/2; sy=0;
                } else {
                    sw=img.naturalWidth; sh=sw/ratio; sx=0; sy=(img.naturalHeight-sh)/2;
                }
                ctx.drawImage(img, sx, sy, sw, sh, x, y, cellW, cellH);

                if(showNum) {
                    const fs = Math.max(24, cellW * 0.15);
                    ctx.save();
                    ctx.fillStyle = "rgba(255,255,255,0.95)";
                    ctx.beginPath();
                    ctx.moveTo(x,y); ctx.lineTo(x+fs*1.4, y); ctx.lineTo(x+fs*1.4, y+fs*1.1);
                    ctx.arc(x+fs*1.4-20, y+fs*1.1-20, 20, 0, Math.PI/2);
                    ctx.lineTo(x, y+fs*1.1); ctx.fill();
                    ctx.fillStyle="#000"; ctx.font=`800 ${fs}px Arial`;
                    ctx.textBaseline="top"; ctx.fillText(i+1, x+fs*0.15, y+fs*0.05);
                    ctx.restore();
                }
            }

            if(wmOp > 0) {
                const pSize = 15;
                const pCvs = document.createElement('canvas');
                pCvs.width = pSize; pCvs.height = pSize;
                const pCtx = pCvs.getContext('2d');
                pCtx.strokeStyle = `rgba(255,255,255,${wmOp})`;
                pCtx.lineWidth = 1.5;
                pCtx.beginPath(); pCtx.moveTo(0,0); pCtx.lineTo(pSize, pSize); pCtx.stroke();
                ctx.fillStyle = ctx.createPattern(pCvs, 'repeat');
                ctx.fillRect(0,0, totalW, totalH);
            }

            cvs.toBlob(b => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(b);
                a.download = `bengdai_stitch_${Date.now()}.png`;
                a.click();
                btn.innerText="保存拼图 (高清)"; btn.disabled=false;
            }, 'image/png');
        } catch(e) {
            alert("内存不足"); btn.disabled=false;
        }
    }

    function dlSingle() {
        const txt = document.getElementById('dlIdx').value;
        if(!txt) return;
        const arr = txt.split(/[\s,]+/).map(n=>parseInt(n)-1);
        arr.forEach(i=>{
            if(images[i]) {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(images[i].blob);
                a.download = `bengdai_img_${i+1}_${Date.now()}.png`;
                a.click();
            }
        });
    }

    // --- 存档库 (带精确时间) ---
    function saveToVault() {
        if(!images.length) return;
        const name = document.getElementById('arcName').value || "未命名存档";
        const noteStr = images.map(i => i.note).join("##");
        const tx = db.transaction("archives", "readwrite");
        tx.objectStore("archives").add({
            title: name,
            date: Date.now(),
            images: images,
            keywords: noteStr
        });
        tx.oncomplete = () => { alert("已存档"); loadVaultList(); }
    }

    function loadVaultList() {
        if(!db) return;
        const key = document.getElementById('vaultSearch').value.toLowerCase();
        const list = document.getElementById('vaultList');
        list.innerHTML = "";

        db.transaction("archives", "readonly").objectStore("archives").getAll().onsuccess = e => {
            const arr = e.target.result.reverse();
            arr.forEach(item => {
                if(key && !item.title.toLowerCase().includes(key) && !(item.keywords||"").toLowerCase().includes(key)) return;

                // 格式化时间
                const timeStr = new Date(item.date).toLocaleString('zh-CN', { hour12: false });

                const d = document.createElement('div');
                d.className = "archive-item";
                d.innerHTML = `
                    <div class="archive-info" onclick="loadArchive(${item.id})">
                        <h4>${item.title}</h4>
                        <p>${timeStr} · ${item.images.length}张</p>
                    </div>
                    <button class="danger" style="width:30px; margin:0;" onclick="delArchive(${item.id})">×</button>
                `;
                list.appendChild(d);
            });
        };
    }

    window.loadArchive = function(id) {
        if(images.length && !confirm("覆盖当前画布？")) return;
        db.transaction("archives", "readonly").objectStore("archives").get(id).onsuccess = e => {
            if(e.target.result) {
                images = e.target.result.images;
                document.getElementById('arcName').value = e.target.result.title;
                setTab('editor');
                render();
            }
        };
    };

    window.delArchive = function(id) {
        if(confirm("删除存档？")) {
            db.transaction("archives", "readwrite").objectStore("archives").delete(id).onsuccess = loadVaultList;
        }
    };

    window.nukeDB = function() {
        if(confirm("确定清空库？")) {
            db.transaction("archives", "readwrite").objectStore("archives").clear().onsuccess = loadVaultList;
        }
    };
</script>
</body>
</html>
